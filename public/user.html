<!DOCTYPE HTML>
<html>
   <head>
      <meta charset="UTF-8">
      <title>Aliro</title>
      <link rel= "SHORTCUT ICON" href="images/lambda_16x16.png" />
      <link href="css/sm-core-css.css" rel="stylesheet" type="text/css">
      <link href="css/sm-simple.css" rel="stylesheet" type="text/css">
      <link href="css/jquery-ui.min.css" rel="stylesheet">
      <link href="css/signInCss.css" rel="stylesheet">
      <link href="css/user.css" rel="stylesheet" type="text/css">
      <link href="css/pageStyle.css" rel="stylesheet" type="text/css">
      <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
      <!--<script src="libs/jquery-1.11.3.min.js"></script>-->
      <script src="libs/jquery-ui.min.js"></script>
      <script src="libs/jquery.smartmenus.min.js"></script>
      <script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['corechart']}]}"></script>
      <script src="javascript/index-logic.js"></script>
   </head>
   <body class="colorBody">
      <script type="text/javascript">
         var currentUser = null;
         $(document).ready(function() {
         //load the navBar and signIn box.
         	$.getScript('javascript/index-logic.js', function(jd){});
         });
      </script>
      <script>
		$(document).ready(function() {
		    var url = window.location.href;
		    var userId = url.slice(url.indexOf('?id=') + 4);
		    if(url.indexOf('?id=') < 0) {
		    	$('.grid').html('<br /><p><center>No user id specified.</center></p><br />');
		    	return false;
		    }
		    var searchUser = {
		        "query": userId,
		        "searchtype": "id"
		    };
		    $.ajax({
		        url: '/getUser',
		        type: 'POST',
		        contentType: 'application/json',
		        data: JSON.stringify(searchUser),
		        dataType: 'json',
		        success: function(userObj) {
		            var finalPaperHtml = '';
					      var c1 = 0;
                if (userObj.publications == 0) {
                    finalPaperHtml = '<br /><p>This user has no publications.</p><br /><br />';
                }
                for (var i = 0; i < userObj.publications.length; i++) {
                    var searchPaper = {
                        "query": userObj.publications[i],
                        "searchtype": "id"
                    }
                    $.ajax({
                        url: '/getPaper',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(searchPaper),
                        dataType: 'json',
                        success: function(paperObjcurs) {
	                    	  var paperObj = paperObjcurs[0];
	                    	  c1++;
								          finalPaperHtml += '<div class="paper">\
									                             <a href="paper.html?id='+paperObj._id+'"><h3>'+paperObj.title+'</h3></a>\
										                         </div>'
								          if (c1 < userObj.publications.length) {
								             finalPaperHtml += '<div class="separator"></div>'
								          }
								         $('#publications').html(finalPaperHtml);
                        }
                    });
                }
					      var userHtml = '<div class="user">\
										<div class = "user">\
											<div class="userBox">\
												<h1 class="headerName">' + userObj.firstname + ' ' + userObj.lastname + '</h1>\
													<div class="details">\
														<p class="school">' + userObj.school + '</p>\
														<p class="grade">' + userObj.grade + 'th Grade</p>\
													</div>\
												<div class="about" id="about">\
														<p class="since">Joined on '+ userObj.datejoined +'</p>\
														<p class="id">User Id: ' + userObj._id + '</p>\
													</div>\
												</div>\
												<div class="separator separator2" id="userPubSep"></div>\
												<div class="publications">\
													<h1>Publications</h1>\
													<div id="publications"></div>\
												</div>\
											</div>\
										</div>'
					      $('.grid').html(userHtml);
		        },
		        error: function(jqXHR, textStatus) {
		        	$('.grid').html('<br /><p><center>Sorry, no user is found with the User Id: '+ searchUser.query + '.</center></p><br />')
		        	return false;
		        }
		    });
		});
      </script>
      <div class="navigation"></div>
      <div id="signInBox"></div>
      <div class="grid"></div>
   </body>
</html>
