<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>Submit Your Research</title>
<link rel= "SHORTCUT ICON" href="images/lambda_16x16.png" />
	<link href="css/sm-core-css.css" rel="stylesheet" type="text/css">
	<link href="css/sm-simple.css" rel="stylesheet" type="text/css">
	<link href="css/jquery-ui.min.css" rel="stylesheet">
	<link href="css/signInCss.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/paper.css" media="all">
	<link href="css/pageStyle.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<!--<script src="libs/jquery-1.11.3.min.js"></script>-->
	<script src="libs/jquery-ui.min.js"></script>
	<script src="libs/jquery.smartmenus.min.js"></script>
	<script src="javascript/index-logic.js"></script>
	<script type="javascript/compatibility.js"></script>
	<script src="javascript/pdf.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$.getScript('javascript/index-logic.js', function(jd){});
			var paperHtml = '',
				title = '',
				date = '',
				school = '',
				authors = '',
				abstractText = '',
				pdfLoc = '',
				paperID = '',
				keywords = [],
				firstAuthor=true;

			var searchPaper = {
				"query": (window.location.href).slice((window.location.href).indexOf('?id=') + 4),
				"searchType": "id"
			}

			$.ajax({
				url: '/getPaper',
				type: 'POST',
				contentType: 'application/json',
				data: JSON.stringify(searchPaper),
				dataType: 'json',
				success: function(data) {
					firstAuthor = true;
					var pdata = data[0];
					console.log(JSON.stringify(pdata));
					$.each(pdata, function(infoName, info) { //loop through each piece of info in the paper
						if(infoName =='authors'){ //going into the authors
							//then it's authors
							authors+='<div class="authors">';
							for (var i = 0; i<info.length; i++){
								//reverse search info[i]. Returned author object will be called authorObj
								var searchAuthor = {
									"query": info[i],
									"searchType": "id"
								}
								console.log(info[i])
								$.ajax({
									url: '/getUser',
									type: 'POST',
									contentType: 'application/json',
									data: JSON.stringify(searchAuthor),
									dataType: 'json',
									success: function(doc) {
										console.log(JSON.stringify(doc));
										var fullName= doc.firstname + ' ' + doc.lastname;
										var userId = doc._id;
										var userPage = "user.html?id=" + userId;
										if(firstAuthor == true)
											authors += '<a href="' + userPage + '">' + fullName + '</a>';
										else
											authors += ', <a href="' + userPage + '">' + fullName + '</a>';
										paperHtml = '<div id="paperDiv">\
								  		<div class="paperOptions">\
											<div class="downloadPDF">\
												<a href="'+pdata.pdf+'"><img src="images/pdfIcon.png">Download PDF</a>\
											</div>\
										</div>\
										<div class="paperCol">\
											<div class="paper">\
												<h3>'+pdata.title+'</h3>'+authors+'</div>\
											<div class="school">\
												<p>'+doc.school+'</p>\
											</div>\
											<div class="date">\
												<p>'+pdata.date+'</p>\
											</div>\
											<div class="abstract">\
												<span class="abstractHead">\
													<h4 class="abstractHeadText">Abstract</h4>\
												</span>\
												<div class="abstractText">\
												<p>'+pdata.abstract+'</p>\
											</div>\
										</div>\
										<div id="pdf-container">\
										<embed src="'+data.pdf+'" width="98%" height="700" type="application/pdf">\
									</div>\
									<div class="posterPics">\
										<p>Poster Pictures</p>\
										<p class="caption">Screenshot of poster used at science fair (we will use a photo viewer plugin here)</p>\
									</div>\
								</div>\
							</div>\
						</div>'
						$('.grid').html(paperHtml);
									firstAuthor = false;
									}
								});
							}; //end author loop
						}//end "if authors"
					}); //end loop through for each piece of info in paper
				}
			});
		}); //end ready
	</script>
</head>

<body class="colorBody">

	<div class="navigation"></div>
	<div id="signInBox"></div>

	<div class="grid">
	</div>
</body>
</html>
