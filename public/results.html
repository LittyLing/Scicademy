<!DOCTYPE HTML>
<html>
   <head>
      <meta charset="UTF-8">
      <title>Aliro</title>
      <link rel= "SHORTCUT ICON" href="images/lambda_16x16.png" />
      <link href="css/sm-core-css.css" rel="stylesheet" type="text/css">
      <link href="css/sm-simple.css" rel="stylesheet" type="text/css">
      <link href="css/jquery-ui.min.css" rel="stylesheet">
      <link href="css/signInCss.css" rel="stylesheet">
      <link href="css/searchBox.css" rel="stylesheet" type="text/css">
      <link href="css/results.css" rel="stylesheet" type="text/css">
      <link href="css/pageStyle.css" rel="stylesheet" type="text/css">
      <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
      <!--<script src="libs/jquery-1.11.3.min.js"></script>-->
      <script src="libs/jquery-ui.min.js"></script>
      <script src="libs/jquery.smartmenus.min.js"></script>
      <script src="javascript/index-logic.js"></script>
   </head>
   <body class="colorBody">
      <script type="text/javascript">
         $(document).ready(function(){
         //load the navBar and signIn box.
         	$.getScript('javascript/index-logic.js', function(jd){});
         });
      </script>
      <script>
         $(document).ready(function() {
         	$( "#dateOptions" ).position({
         		  my: "left top",
         		  at: "left-3 bottom+10",
         		  of: "#dates h6"
         	});	//end position
         	var url= window.location.href;
         	var queryString=url.slice(url.indexOf('query=')+6);
         	queryString = decodeURI(queryString);
         	var searchType = url.charAt(url.indexOf('type=')+5);
          if(searchType == 1)
            searchType = "All";
          else if(searchType == 2)
            searchType = "Title";
          else if(searchType == 3)
            searchType = "Keyword";
          else if(searchType == 4)
            searchType = "Author";
         	var searchPaper = {
         		"query": queryString,
         		"searchType": searchType
         	}

         	$.ajax({
         		url: '/getPaper',
         		type: 'POST',
         		contentType: 'application/json',
         		data: JSON.stringify(searchPaper),
         		dataType: 'json',
         		success: addPapers
         	});

         	function addPapers(data) {
            $('.papers').html('');
            if(data.length == 0) {
              $('.papers').append(
                '<div class="paperDiv">\
           							<span class="title">\
           								<a href=""><h3>Sorry, nothing matched your search.</h3></a>\
           							</span><div class="authors"></div></div>\
           							<div class="abstractDiv">\
           								<a class="abstractText">\
           									<span class="arrowClick arrowSide"></span>\
           									<span class="preTxt">Don\'t lose hope!</span>\
           								</a>\
           							<div class="abstractParagraph" id="abstract0">If you are looking for a specific paper and it\'s not here, try searching by Author (All Fields searches Author by User Id).<br /> If you\'re looking to see if your idea is original, you\'re in luck!</div>\
                        <div class="abstractParagraph" id="abstract0.5"><br /><em>\"Originality is nothing but judicious imitation. The most original writers borrowed one from another\"</em> -Voltaire</div>\
                      </div>\
           					</div>\
           				<div class="separator"></div>'
              );
            }
            var title='',
         			authors='',
         			abstractText='',
         			firstAuthor=true,
              nump = 0;

         		var paperHtml='';
         		$.each(data, function(paper, paperInfo){ //iterate through each paper
         			$.each(paperInfo, function(infoName, info){ //loop through each piece of info in the paper
					if(infoName =='authors') { //going into the authors
						//then it's authors
            var firstAuthor = true;
						for (var i = 0; i< info.length; i++) {
							//reverse search info[i]. Returned author object will be called authorObj
              var authorreq = {
                "query": info[i],
                "searchType": "id",
                "meta": nump
              }
              $.ajax({
             		url: '/getUser',
             		type: 'POST',
             		contentType: 'application/json',
             		data: JSON.stringify(authorreq),
             		dataType: 'json',
             		success: function(docB) {
                  var authorObj = docB.doc;
                  var fullName= authorObj.firstname + ' ' + authorObj.lastname;
    							var userId = authorObj._id;
    							var userPage = "user.html?id=" + userId;
                  if(firstAuthor) {
                    authors = '<a href="' + userPage + '">' + fullName + '</a>';
                    firstAuthor = false;
                  }
    							else {
                    authors += '<a href="' + userPage + '">, ' + fullName + ' </a>';
                  }
                  $('#authors'+(docB.meta)).html(authors);
                }
             	});
						}; //end author loop
					} //end author if
					else{ //every piece of info but authors
						if(infoName == 'title'){
							title=info;
						}
						else if (infoName == 'abstract'){
							abstractText=info;
						}
					} //end else for everything but authors
         			}); //end loop through for each piece of info in paper
         			paperHtml='<div class="paperDiv">\
         							<span class="title">\
         								<a href="/paper.html?id='+paperInfo._id+'"><h3>'+title+'</h3></a>\
         							</span><div class="authors" id="authors'+nump+'"></div></div>\
         							<div class="abstractDiv">\
         								<a class="abstractText">\
         									<span class="arrowClick arrowSide"></span>\
         									<span class="preTxt">Abstract</span>\
         								</a>\
         								<div class="abstractParagraph" id="abstract1">'+abstractText+'</div>\
         							</div>\
         						</div>\
         						<div class="separator"></div>'
              $('.papers').append(paperHtml);
              nump++;
         		}); //end loop for each paper

       	}//end addPapers
         	$('.papers').on('click', '.abstractDiv', function() {
         		$(this).find('.arrowClick').toggleClass('arrowSide');
         		//$('.abstractParagraph').slideToggle();
         		$(this).find('.abstractParagraph').slideToggle();
         		return false;
         	});//end abstractText click
         }); //end ready
      </script>
      <div class="navigation"></div>
      <div id="signInBox"></div>
      <div class="grid" id ="grid">
      <div class="searchBoxDiv" id="search-form">
         <form class="form-container" action="">
            <input type="text" class="search-field" id="searchBox" placeholder="Find Research" maxlength="2048"  />
            <div class="submit-container">
               <input type="submit" value="" class="submit searchBoxSubmit" />
            </div>
         </form>
      </div>
      <div id="searchTableDiv">
         <div class="searchInfo">
            <div class="searchBy">
               <h4>Search In:</h4>
               <div id="searchOptions">
                  <input type="radio" name="searchTypeOptions" value="All" class="searchBy" checked="checked">All Fields</input><br>
                  <input type="radio" name="searchTypeOptions" value="Title" class="searchBy">Title</input><br>
                  <input type="radio" name="searchTypeOptions" value="Keyword" class="searchBy">Keyword</input><br>
                  <input type="radio" name="searchTypeOptions" value="Author" class="searchBy">Author</input>
               </div>
            </div>
<!--             <div class="sortBy">
               <h4>Sort By:</h4>
               <div id="dates">
                  <h6>Date:</h6>
                  <div id="dateOptions">
                     <input type="checkbox" name="date" value="2015" class="dateButtons">2014</input>
                     <br>
                     <input type="checkbox" name="date" value="2015" class="dateButtons">2015</input>
                  </div>
               </div>
            </div> -->
         </div>
         <div class="papers">
           <br />
           <br />
           <p><center id="benFrank"><em>He that can have patience can have what he will.</em> -Benjamin Franklin</center></p>
         </div>
      </div>
	</div>
   </body>
</html>
