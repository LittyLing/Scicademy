<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>Submit Your Research</title>
<link rel= "SHORTCUT ICON" href="images/lambda_16x16.png" />
	<link href="css/sm-core-css.css" rel="stylesheet" type="text/css">
	<link href="css/sm-simple.css" rel="stylesheet" type="text/css">
	<link href="css/jquery-ui.min.css" rel="stylesheet">
	<link href="css/signInCss.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/paper.css" media="all">
	<link href="css/pageStyle.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
	<script src="libs/jquery-1.11.3.min.js"></script>
	<script src="libs/jquery-ui.min.js"></script>
	<script src="libs/jquery.smartmenus.min.js"></script>
	<script src="javascript/index-logic.js"></script>
	<script type="javascript/compatibility.js"></script>
	<script src="javascript/pdf.js"></script>
	<script type="text/javascript"> 
		var currentUser = null;
		$(document).ready(function() {
			$.getScript('javascript/index-logic.js', function(jd){});
			var url = "projects/1/Aram_Baghdassarian_Paper.pdf" /*this should be variable*/
		//start JSON to load paper.
			<!-- $.getJSON('paperPage.js', paperData, addPaper); -->
			//JSON data format: (similar to that of results.html, but for onl one paper)
			var data={
					"title":"Title of Paper",
					"date":"May 15, 1999",
					"school":"Stanford High School",
					"authors":{
						"author1":{
							"name":"Larry Page",
							"userPage":"user.html/userID"
						},
						"author2":{
							"name":"Sergey Brin",
							"userPage":"user.html/userID"
						}
					},
					"abstract":"asdkfla",
					"pdfLoc":"projects/1/Aram_Baghdassarian_Paper.pdf"
			}
			var paperHtml='';
			var title='';
			var date='';
			var school='';
			var authors='';
			var abstractText='';
			var pdfLoc='';
			firstAuthor=true;
		
			$.each(data, function(infoName, info){ //loop through each piece of info in the paper
				if(typeof info === 'object'){ //going into the authors
					//then it's authors
					$.each(info, function(authorNum, value){
						if(!firstAuthor){
							authors+=',&nbsp;&nbsp;';
						}
						else{
							authors+='<div class="authors">';
							firstAuthor=false;
						}
						// value.name gets their name, value.userPage gets their userPage
						authors+='<a href="'+value.userPage+'">'+value.name+'</a>';
					}); //end author loop
					firstAuthor=true;
				} //end author selection
				else{ //every piece of info but authors
					if(infoName == 'title'){
						title=info;
					}
					else if (infoName == 'abstract'){
						abstractText=info;
					}
					else if (infoName == 'date'){
						date=info;
					}
					else if (infoName == 'school'){
						school=info;
					}
					else if (infoName == 'pdfLoc'){
						pdfLoc=info;
					}
				} //end else for everything but authors
			}); //end loop through for each piece of info in paper
		paperHtml='<div id="paperDiv">\
					Auto-generated. This second paper is here just for now. Will delete both later once server side stuff is done, and JSON brings everything automatically:\
					<div class="paperOptions">\
						<div class="downloadPDF">\
							<a href="'+pdfLoc+'"><img src="images/pdfIcon.png">Download the pdf</a>\
						</div>\
					</div>\
					<div class="paperCol">\
						<div class="paper">\
							<h3>'+title+'</h3>'+authors+'</div>\
							<div class="school">\
								<p>'+school+'</p>\
							</div>\
							<div class="date">\
								<p>'+date+'</p>\
							</div>\
							<div class="abstract">\
								<span class="abstractHead">\
									<h4 class="abstractHeadText">Abstract</h4>\
								</span>\
								<div class="abstractText">\
									<p>'+abstractText+'</p>\
								</div>\
							</div>\
							<div id="pdf-container"> \
								<div>\
									<button id="prev">Previous</button>\
  									<button id="next">Next</button>\
  									&nbsp; &nbsp;\
 									<span>Page: <span id="page_num"></span> / <span id="page_count"></span></span>\	</div>\
 								<div>\
 								<canvas id="pdf_canvas" style="border:1px solid black"></canvas>\
 								</div>\
							</div>\
							<div class="posterPics">\
								<p>Poster Pictures</p>\
								<p class="caption">Screenshot of poster used at science fair (we will use a photo viewer plugin here)</p>\
							</div>\
						</div>\
					</div>\
		</div>'
		$('.grid').append(paperHtml);
		
		//end JSON stuff to load paper
		
		
		var pdfDoc = null,
			pageNum = 1,
			pageRendering = null,
			scale = 0.8,
			canvas = document.getElementById('pdf_canvas'),
			ctx = canvas.getContext('2d');
		function renderPage(num) {
    		pageRendering = true;
    		// Using promise to fetch the page
		    pdfDoc.getPage(num).then(function(page) {
      			var viewport = page.getViewport(scale);
      			canvas.height = viewport.height;
      			canvas.width = viewport.width;

      			// Render PDF page into canvas context
      			var renderContext = {
      			  canvasContext: ctx,
      			  viewport: viewport
      			};
     			var renderTask = page.render(renderContext);

     			// Wait for rendering to finish
     			renderTask.promise.then(function () {
      				pageRendering = false;
      				if (pageNumPending !== null) {
      			    	// New page rendering is pending
      			    	renderPage(pageNumPending);
      			    	pageNumPending = null;
        			}
      			});
    		});
    		document.getElementById('page_num').textContent = pageNum;
		}
		PDFJS.getDocument(url).then(function (pdfDoc_) {
    		pdfDoc = pdfDoc_;
    		document.getElementById('page_count').textContent = pdfDoc.numPages;
    		// Initial/first page rendering
    		renderPage(pageNum);
  		});
		function queueRenderPage(num) {
    		if (pageRendering) {
      			pageNumPending = num;
    		} else {
      			renderPage(num);
    		}
  		}
  		function onPrevPage() {
    		if (pageNum <= 1) {
      			return;
    		}
    		pageNum--;
    		queueRenderPage(pageNum);
  		}
	  	document.getElementById('prev').addEventListener('click', onPrevPage);
	  	function onNextPage() {
    		if (pageNum >= pdfDoc.numPages) {
      			return;
    		}
    		pageNum++;
    		queueRenderPage(pageNum);
  		}
  		document.getElementById('next').addEventListener('click', onNextPage);
		
		$('#editPaper').click(function(event){
			event.preventDefault();
			if (($(this).text() === "Edit Paper")){
				$(this).text("Finished Editing");
			}
			else{
				$(this).text("Edit Paper");
			}
			//Title to textbox
		//	var textArea = $('<textarea>');
		//	var endTextArea=$('</textarea>');
		//	var oldText = $('.paper h3').text();
		//	$('.paper h3').prepend(textArea);
		//	$('.paper h3').prepend(textArea);
		//	$('.paper h3').append(endTextArea);
		//	textArea.val(oldText);
			//end Title
			
			
		}); //end edit click
	}); //end ready
	</script>
</head>

<body class="colorBody">
	
	<div class="navigation"></div>
	<div id="signInBox"></div>
	
	<div class="grid">
		<a href='' id="editPaper">Edit Paper</a>
		<div id="paperDiv">
					<div class="paperOptions">
						<div class="downloadPDF">
							<a href='projects/1/Aram_Baghdassarian_Paper.pdf'><img src="images/pdfIcon.png">Download the pdf</a>
						</div>
					</div>
					
					<div class="paperCol">
						<div class="paper">
							<h3>Title of paper</h3>
							<div class="authors">
								<a href="user.html">Baghdassarian A.</a>
								,&nbsp;&nbsp;
								<a href="user.html">Smith J.</a>
							</div>
							<div class="school">
								<p>Great Neck South High School</p>
							</div>
							<div class="date">
								<p>August 8, 2015</p>
							</div>
							<div class="abstract">
								<span class="abstractHead">
									<h4 class="abstractHeadText">Abstract</h4>
								</span>
								<div class="abstractText">
									<p>
										Lorem ipsum dolor sit amet, consectetur adipiscing elit. In pharetra vitae tellus non mattis. Aenean varius tellus erat, ac elementum risus vulputate vel. Quisque laoreet est vel ex pulvinar rutrum. Maecenas in ornare mi. Etiam ut sollicitudin elit, sit amet auctor sapien. Duis a eleifend felis, sollicitudin egestas purus. Cras molestie sapien quis nisl faucibus tempus. Phasellus dignissim suscipit libero eget laoreet. Suspendisse eget est felis. Fusce sodales, arcu at lacinia semper, quam metus fringilla velit, eget hendrerit diam orci elementum dolor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Donec suscipit, elit non aliquet malesuada, augue sapien gravida quam, ac feugiat lorem turpis a turpis. Vestibulum erat ipsum, efficitur vel interdum fringilla, vulputate nec neque. Donec aliquet orci lorem, a commodo lectus tristique non.
									</p>
								</div>
							</div>
							<div id="pdf-container">
								<div>
									<button id="prev">Previous</button>
  									<button id="next">Next</button>
  									&nbsp; &nbsp;
 									<span>Page: <span id="page_num"></span> / <span id="page_count"></span></span>	
 								</div>
 								<div>
 								<canvas id="pdf_canvas" style="border:1px solid black"></canvas>
 								</div>
							</div>
							<div class="posterPics">
								<p>Poster Pictures</p>
								<p class="caption">Screenshot of poster used at science fair (we'll use a photo viewer plugin here)</p>
							</div>
						</div>
					</div>
		</div>
	</div>
</body>
</html>